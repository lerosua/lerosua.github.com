
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>阳光烂灿的日子</title>
  <meta name="author" content="lerosua">

  
  <meta name="description" content="数码相机。像素500万左右。这样可以记录我的流浪生活，为我的出游做准备。其实我是很喜欢照相
的。每次看见以前的自己，总会有些感动。每次看见相片里的自己，再看看镜子里的自己，才会感到
成长的变化。世事沧桑都会反应在相片中！
希望这两三个月能实现。 宽屏显示器。这样在电脑前干什么事都爽。 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://lerosua.github.io/blog/page/64">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="阳光烂灿的日子" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">阳光烂灿的日子</a></h1>
  
    <h2>--记录所有碎碎念</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:lerosua.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2006/08/27/recentdesire/">最近期的物质欲望</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-08-27T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2006/08/27/recentdesire/#disqus_thread"
             data-disqus-identifier="http://lerosua.github.io/blog/2006/08/27/recentdesire/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><font color="#6633ff">数码相机</font>。像素500万左右。这样可以记录我的流浪生活，为我的出游做准备。其实我是很喜欢照相<br />
的。每次看见以前的自己，总会有些感动。每次看见相片里的自己，再看看镜子里的自己，才会感到<br />
成长的变化。世事沧桑都会反应在相片中！<br />
希望这两三个月能实现。</p>

<p><font color="#993399">宽屏显示器</font>。这样在电脑前干什么事都爽。这个欲望有点奢侈。但渴望中！ 因为比较奢侈，所以不急着<br />
实现。计划这一两年内！</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2006/08/26/whynotiusewindows/">我为什么不选择Windows</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-08-26T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2006/08/26/whynotiusewindows/#disqus_thread"
             data-disqus-identifier="http://lerosua.github.io/blog/2006/08/26/whynotiusewindows/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><div align="center">偶尔看到CSDN上一位技术人员发表的Blog文章:<a href="http://blog.csdn.net/microrain/archive/2006/08/25/1115543.aspx">我们为什么不选择Linux？</a></div>
本来是见惯世面了，这类文章在各大Linux论坛中是每个月都会出现的，大家都称<br />
之为”月经贴“的啦！一般是一两个新人试用了Linux一两天，然后就以救世主的姿态<br />
来说明是Linux需要普及还需要什么什么的！然后下面又有一大堆新近的Linux爱好者<br />
说明楼主怎样怎样。颇有troll的嫌疑。<br />
偶作为乡民（网络用语：看热闹的人）的身份，<br />
浏览了一遍，本来是普通用户的话，就算了，可是一位技术人员，偶对他就有些求全责备<br />
了。关于反对的话我也不说了，因为不需要我说。它的回贴者已经很好地回应了。<br />
不过有好些回贴者又发起了人身攻击，这也是不太应该。不过这位技术人员得负些责任了。<br />
本来这个选择window还是linux的问题，几乎可以比美宗教斗争了。一个派系攻击另一个派系<br />
。在中国有一个特点，任何的争论，最后都只会剩下口舌之争，互相人身攻击。</p>

<p>下面是上面博客中一个留言内容。<br />
================================
<div><font color="#990000"><a rel="nofollow" target="_blank" href="http://blog.csdn.net/microrain">microrain</a> 发表于2006-08-26 04:58:00  IP: 221.217.117.*</font></div>
<font color="#990000">详细看了一下大家的回复，对于反对我的人，如果你是在windows+IE下回复你的反对言伦的，我鄙视你。自己就在做着否定自己的事情，怎么有资格说别人，特别是那些骂人的，请先看看你自己在用什么？你自己为什么不天天使用linux，想明白了再回复。
</font>
================================
<font color="#000000">
</font><font color="#000000">偶现在已经可以算得上是纯正的Linux爱好者了，偶是天天用Linux的，因为偶硬盘上没有windows。<br />
所以偶想偶还是有资格说说你们的吧！当然我不是要骂你  ， 呵呵~</font></p>

<p>{也许偶也写一篇名叫<font color="#663366">偶为什么不选择Linux</font>，或<font color="#663366">Linux在中国没前途</font>之类的文章，偶博客的<br />
点击率会立马上去哩~ :)}</p>

<p>偶作为有聊之就写一遍：<font color="#993399">我为什么不选择Window</font>相对应吧。对于不了解Linux的初学者偶以前也写过一篇文章了,<a rel="bookmark" href="http://my.donews.com/lerosua/2006/05/05/%e7%bb%99linux%e5%88%9d%e5%ad%a6%e8%80%85%e8%af%b4%e6%b8%85%e7%9a%84%e5%87%a0%e4%b8%aa%e9%97%ae%e9%a2%98/">给Linux初学者说清的几个问题</a>不再重复。偶不用我们，偶没有找到其他<br />
人认同偶代表他的。所以只是行使偶自己的言论自由，决不以大众的名义去忽攸大家。</p>

<p>1.Windows要钱，太贵了。<br />
装一个Windows XP，要三千多吧，再来个办公的office，又要三千多。<br />
流行软件是很多。不过大部分要自己找注册码破解。不然就是广告，弹出栏。时间限制。<br />
我跟你讲，这纯属道德问题。<br />
&#8211; 引自《疯狂的石头》<br />
盗版问题也不多说了。这里提一下，你是用得理直气壮的话我也无语。大家得了便宜还是<br />
得卖点乖。别大声张扬。</p>

<p>2.病毒流行。<br />
几乎每年都会爆发一次大规模的病毒风波吧。像那次什么冲激波，震荡波啊。为了防病毒，装<br />
杀毒软件吧。内存本来就不多，还要分一部分给杀毒软件，防火墙。晕。杀毒软件也是要钱的<br />
啊。找破解版，上网到处找注册码。</p>

<p>3.流氓软件很多，随时有被插的危险。<br />
偶舍友用的是windows，因为他的电脑放在厅里，所以吃饭的时候偶们会看一下他电脑上的片子。<br />
用realone打开一个电影。十秒钟内跳出十个页面，挡住了屏幕。严重影响观赏。因为偶不熟习<br />
window，举不出更多的例子了。不过看看donew就知道了，最近老在谈论这个流氓软件哩。<br />
更有甚者，还有一位博客提出流氓插的时候温柔点，别改主页，注册表就行。偶当时看了感觉就像<br />
在请求强奸犯做案的时候带套，冷静地对待。已经达到见惯不怪的地步了，可谓之强。<br />
偶没有这个习惯，所以别搞我！</p>

<p>4.重装率频繁<br />
系统用得久了就一定会慢，磁盘就肯定乱。这几乎是定理。当时是很多熟知电脑（其实是Window）<br />
的人告诉我的。用windows的几乎是每三个月重装一次。遇到问题的唯一解决方法就是重装，别<br />
告诉我你是技术高手。当年在我认识的高手当中（如今不少是程序员），自己解决问题，帮别人解决<br />
问题的方式就是重装。</p>

<p>linux出了问题，偶可以去google找答案，去irc，qq群里问人。耐心好一点都是可以解决的，并且还<br />
可以学习到新的东西。无论怎样大的问题，都可以不用重装解决（除非你整个硬盘坏了）。</p>

<p>4样式单一。<br />
永远是蓝天白云。千篇一律。没有个性化。定制个东西难于上青天。因为提供的都是二进制的东西。<br />
虽然有改主题的软件，但是占用太大的资源了。并且还是用别人的东西，不能激活自己的创造性。<br />
并且好像还要钱。</p>

<p>5.不利用于学习编程<br />
默认装上的window，没有编程功能。还要自己去找个ide。一个ide几乎是一个系统那么大了。天啊<br />
，我只想写个hello world而已啊。想找个源代码看看，学习下编程。买书吧，书中有例子。有没有<br />
项目大一点的开源软件啊？ 有啊，Linux下繁星那么多。window下的mfc的就好难找了。嗯，去找些<br />
人一起讨论讨论吧。高手好像都不上QQ群的，irc上都是linux爱好者。<br />
想学习下操作系统，只有理论，没有代码，window可没有代码公开啊。要学习操作系统，那还是看<br />
Unix类。</p>

<p>就写这么多吧。写了许久突然发现无趣这样很无趣。<br />
总之，谁解决了我上述问题。谁的Linux将小行其道。真正成为一小部分人的爱好。不过就算你解决<br />
了，我也不会选择windows。 我不选择window并不是因为上面的原因。<font color="#999900">我不选择window的原因很<br />
简单，因为我选择了Linux</font>。<font color="#990000">我选择linux的原因也很简单，因为我喜欢这个系统</font>。关你window什么事。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2006/08/25/dowhile0/">DoWhile(0)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-08-25T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2006/08/25/dowhile0/#disqus_thread"
             data-disqus-identifier="http://lerosua.github.io/blog/2006/08/25/dowhile0/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>更详细参考<a target="_parent" href="http://kernelnewbies.org/FAQ/DoWhile0">Kernelnewbies</a></p>

<p>为啥内核里有这么多 do{ }while(0) 的宏啊？一开始我也好不明白。感觉不出用了会有什么效果。不过明白之后就知道它的好处了。好处就在于多语句的宏。
<pre /><font color="#ff0000">#define FOO(x)	print("arg is %sn",x);do_something(x);</font>
在代码中使用：
<pre /><font color="#ff0000">if(2==blah)</font></p>

<p><font color="#ff0000">	FOO(blah);</font>
预编译展开后：
<pre /><font color="#ff0000">if(2==blah)</font></p>

<p><font color="#ff0000">	print("arg is %sn",blah);</font></p>

<p><font color="#ff0000">do_something(blah);</font>
看到了吧，do_something函数已经脱离了if语句的控制了。这可不是我们想要的。使用do{}while(0);就万无一失了。
<pre /><font color="#ff0000">if (2== blah)</font></p>

<p><font color="#ff0000">  do {</font></p>

<p><font color="#ff0000">	printf("arg is %sn", blah);</font></p>

<p><font color="#ff0000">	do_something(blah);</font></p>

<p><font color="#ff0000">  } while (0);</font></p>

<p>当然你也可以使用下面这种形式：</p>

<p><font color="#ff0000">#define exch(x,y) { int tmp; tmp=x; x=y; y=tmp; }</font></p>

<p>但是它在if-else语句中会出现问题。如:
<pre /><font color="#ff0000">if (x &gt; y)</font></p>

<p><font color="#ff0000">	exch(x,y);          // Branch 1</font></p>

<p><font color="#ff0000">else</font></p>

<p><font color="#ff0000">	do_something();     // Branch 2</font>
展开后：
<pre /><font color="#ff0000">if (x &gt; y) {                // Single-branch if-statement!!! </font></p>

<p><font color="#ff0000">	int tmp;            // The one and only branch consists</font></p>

<p><font color="#ff0000">	tmp = x;            // of the block.</font></p>

<p><font color="#ff0000">	x = y;</font></p>

<p><font color="#ff0000">	y = tmp;v};                           // empty statementelse          </font></p>

<p><font color="#ff0000"> // ERROR!!!   "parse error before else"do_something();</font>
看到了吧，else成了语法错误了。使用do{}while(0)就不会有这个问题了。
<pre /><font color="#cc0000">if (x &gt; y)</font></p>

<p><font color="#cc0000">do {</font></p>

<p><font color="#cc0000">	int tmp;</font></p>

<p><font color="#cc0000">	tmp = x;</font></p>

<p><font color="#cc0000">	x = y;</font></p>

<p><font color="#cc0000">	y = tmp;</font></p>

<p><font color="#cc0000">} while(0);</font></p>

<p><font color="#cc0000">else</font></p>

<p><font color="#cc0000">	do_something();</font>
嗯，现在明白之后，自己的代码也记得用啊！
<a href="http://performancing.com/firefox" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2006/08/23/add_url_icons/">为博客打扮之添加url图标</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-08-23T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2006/08/23/add_url_icons/#disqus_thread"
             data-disqus-identifier="http://lerosua.github.io/blog/2006/08/23/add_url_icons/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>看见过许多网站URL前面都会有一个图标，一些个人的博客的URL上也有。<br />
于是搞来玩玩。<br />
问问了<font color="#336666">TG</font>（偶一网友），得到方法。</p>

<p>===============================</p>

<p><font color="#3333ff">&lt;link rel=&#8221;icon&#8221; xhref=&#8221;/favicon.ico&#8221; mce_href=&#8221;/favicon.ico&#8221;  type=&#8221;image/x-icon&#8221;&gt;</font></p>

<p><font color="#3333ff">
&lt;link rel=&#8221;shortcut icon&#8221; xhref=&#8221;http://static.flickr.com/90/222800378_c6f6a171b3_o.png&#8221; mce_href=&#8221;http://static.flickr.com/90/222800378_c6f6a171b3_o.png&#8221;  </font></p>

<p><font color="#3333ff">type=&#8221;image/x-icon&#8221;&gt;</font></p>

<p>===============================</p>

<p>把png文件的url换成你想要的文件url，并把上面的代码拷贝到你侧栏编辑中的某一栏内容里。
<font color="#ff0000">
<font color="#663333">代码啥意思偶也不清楚，反正能成。不求甚解！ 有空的网友玩玩！</font>
</font></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2006/08/22/no-peer/">睡清华校园的家长不惨。</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-08-22T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2006/08/22/no-peer/#disqus_thread"
             data-disqus-identifier="http://lerosua.github.io/blog/2006/08/22/no-peer/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>咋一看这则新闻，第一印象真的是觉很惨。可怜天下父母心是不错。但回头想想，他们其实不惨啊。<br />
也早有人分析过了。去得了北京的，家里还能算穷的嘛！真正惨的是你见不着的，在乡下砸锅卖铁凑<br />
学费的父母。哪还有钱去北京啊！</p>

<p>偶发一感！</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2006/08/21/likelyunlikely/">LikelyUnlikely</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-08-21T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2006/08/21/likelyunlikely/#disqus_thread"
             data-disqus-identifier="http://lerosua.github.io/blog/2006/08/21/likelyunlikely/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><font color="#000000">更好的解释请看<a target="_parent" href="http://www.kernelnewbies.org/FAQ/LikelyUnlikely">Kernelnewbies</a></font></p>

<p><font color="#000000" /></p>

<p><font color="#000000"><font color="#000000"><font color="#000000">在内核中常会见到下面这样的代码。
</font></font></font>
<pre /><font color="#000000"><font color="#000000"><font color="#990000">bvl = bvec_alloc(gfp_mask, nr_iovecs, &amp;idx);</font></font></font></p>

<p><font color="#990000">if (unlikely(!bvl)) {</font></p>

<p><font color="#990000">  mempool_free(bio, bio_pool);</font></p>

<p><font color="#990000">  bio = NULL;</font></p>

<p><font color="#990000">  goto out;</font></p>

<p><font color="#990000">}</font></p>

<p><font color="#000000"><font color="#990000"></font></font>
<font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000">
</font></font></font></font></font></p>

<p><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000">
这个likely()和unlikely()其实是宏定义。原始定义在 </font><font color="#000000">include/linux/compiler.h中，如下：</font></font></font></font></font></p>

<p><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000">
</font></font></font></font></font>
<pre /><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#996633">#define likely(x)       __builtin_expect(!!(x), 1)</font></font></font></font></font></font></p>

<p><font color="#996633">#define unlikely(x)     __builtin_expect(!!(x), 0)</font></p>

<p><font color="#000000"></font>
<font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"></font></font></font></font></font></font></font></p>

<p><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000">__builtin_expect是GCC内建的函数。下面引用<a target="_parent" href="http://www.nixsky.com/data/2006/0724/article_348.html">linuxform中的一篇讲GCC扩展文章</a></font></font></font></font></font></font></font></font></font></p>

<p><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000">的一部分(<em>原我找到的也是引用的文章，此处给出链接</em>），里面解释得很清楚。</font></font></font></font></font></font></font></font></font></p>

<p><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000">
</font></font></font></font></font></font></font></font></font>
<pre /><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000">-------------------------------------------------------</font></font></font></font></font></font></font></font></font></p>

<p><font color="#000000"><font color="#cc9933">* __builtin_expect(EXP, C)</font></font></p>

<p><font color="#cc9933" /></p>

<p>内建函数 __builtin_expect 用于为编译器提供分支预测信息，其返回值是整数表达式 EXP
<pre /><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#cc9933">的值，C 的值必须是编译时常数。例如：</font></font></font></font></font></font></font></font></font></p>

<p><font color="#cc9933"><font color="#cc9933">++++ include/linux/compiler.h</font></font></p>

<p><font color="#cc9933">13: #define likely(x)       __builtin_expect((x),1)</font></p>

<p><font color="#cc9933">14: #define unlikely(x)     __builtin_expect((x),0)</font></p>

<p><font color="#cc9933">++++ kernel/sched.c</font></p>

<p><font color="#cc9933">564:         if (unlikely(in_interrupt())) {</font></p>

<p><font color="#cc9933">565:                 printk("Scheduling in interruptn");</font></p>

<p><font color="#cc9933">566:                 BUG();</font></p>

<p><font color="#cc9933">567:         }</font></p>

<p><font color="#cc9933" /></p>

<p>这个内建函数的语义是 EXP 的预期值是 C，编译器可以根据这个信息适当地重排</p>

<p><font color="#cc9933">语句块的顺序，使程序在预期的情况下有更高的执行效率。上面的例子表示处于中</font></p>

<p><font color="#cc9933">断上下文是很少发生的，第 565-566 行的目标码可能会放在较远的位置，以保证</font></p>

<p><font color="#cc9933">经常执行的目标码更紧凑。</font></p>

<p><font color="#000000">-------------------------------------------------------</font>
<font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#cc9933"><font color="#000000">
</font></font></font></font></font></font></font></font></font></font></p>

<p><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#cc9933"><font color="#000000">
<strong>总结，这个宏主要是优化的作用。如果英文好的话可以看文章一开始给出的</strong></font></font></font></font></font></font></font></font></font></font></p>

<p><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#cc9933"><font color="#000000"><strong>在kernelnewbies中的链接，那里有更详细的解说。</strong></font></font></font></font></font></font></font></font></font></font></p>

<p><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#cc9933"><font color="#000000"><strong>
细心的人应该留意到有一点不同，likely()一开始偶给的定义为__builtin_expect(!!(x),1)。</strong></font></font></font></font></font></font></font></font></font></font></p>

<p><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#cc9933"><font color="#000000"><strong>
后来的文章解说中成了__builtin_expect((x),1)。
</strong></font></font></font></font></font></font></font></font></font></font></p>

<p><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#cc9933"><font color="#000000"><strong>
这应该是后来的版本更改所至。就是新近版本的内核已经更改成__builtin_expect(!!(x),1). </strong></font></font></font></font></font></font></font></font></font></font></p>

<p><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#000000"><font color="#cc9933"><font color="#000000"><strong>
加上个“!!”有什么好处哩。我想是因为使代码强壮与兼容的原因。因为不能保证x表达式的结果一定是1或0,有可能是非0数。加了“!!”，结果就一定是在1和0范围内了。</strong></font> </font></font></font></font></font> </font></font></font></font></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2006/08/17/performancing/">Blog工具-performancing</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-08-17T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2006/08/17/performancing/#disqus_thread"
             data-disqus-identifier="http://lerosua.github.io/blog/2006/08/17/performancing/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>一直以来我都使用<font color="#00cccc"><strong>Blogtk</strong></font>来作为我的博客写作工具。当然它并不是很好用。功能有限。<font color="#ff0000"><a href="http://huangjiahua.livejournal.com/">华华</a></font>曾经推荐一款博客工具logjam给我，这个是针对于livejournal系统的。当然也支持其它的博客系统。但我对于donews没设置成功。看过一下那个软件也再没用了。还是一直用<em>Blogtk</em>。用来写文字还凑合吧。最近贴一些代码的时候就有些愁了。才感到它的功能那么那么有限。<br />
直到今天才发现firefox有一个写博客的扩展 <a href="http://performancing.com/">Performancing</a>。试用了一下，还是所见既所得的哩，还有颜色设置，很方便啊。才发觉有<font color="#3333ff">相逢恨晚</font>的感觉。嗯，还是和<font color="#006600">Blogtk</font>告别吧。另一个感叹：<font color="#ff0000">Firefox</font>真是强大啊~<br />
理所当然地从今日起，偶的博文都将由Performancing产生了！呵呵!<a href="http://www.flickr.com/photo_zoom.gne?id=216842712&amp;size=o">
</a>    <u>下<font color="#cc33cc">面给个图先！</font></u></p>

<p><a title="Photo Sharing" href="http://www.flickr.com/photos/23336057@N00/216842712/"><img width="510" height="329" alt="博客工具performancing" src="http://static.flickr.com/52/216842712_6386dfd60c_o.png" /></a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2006/08/16/asmlinkage/">什么是asmlinkage</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-08-16T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2006/08/16/asmlinkage/#disqus_thread"
             data-disqus-identifier="http://lerosua.github.io/blog/2006/08/16/asmlinkage/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><font color="#000000">下面首先在<a target="_parent" href="http://kernelnewbies.org/FAQ/asmlinkage">kernelnewibes</a>上的解释。</font>
<pre /><font color="#000000"><strong>What is asmlinkage?</strong>  </font><font color="#993399">The asmlinkage tag is one other thing that we should observe aboutthis simple function. </font><font color="#993399">This is a #define for some gcc magic that tellsthe compiler that the function</font></p>

<p>should not expect to find any of itsarguments in registers (a common optimization),</p>

<p>but only on theCPU's stack. Recall our earlier assertion that system_call consumesits</p>

<p>first argument, the system call number, and allows up to four morearguments that are</p>

<p>passed along to the real system call. system_callachieves this feat simply by leaving its other</p>

<p>arguments (which werepassed to it in registers) on the stack. All system calls are markedwith</p>

<p>the asmlinkage tag, so they all look to the stack for arguments.Of course, in sys_ni_syscall's case,</p>

<p>this doesn't make any difference,because sys_ni_syscall doesn't take any arguments, but it's an</p>

<p>issuefor most other system calls. And, because you'll be seeingasmlinkage in front of many other</p>

<p>functions, I thought you shouldknow what it was about.
<font color="#000000"> </font><font color="#000000">而我在 2.6.8的内核上的include/linux/linkage.h查到它的定义是：</font></p>

<p><font color="#000000"> </font>
<pre /><font color="#990000"> #ifndef asmlinkage</font>
<font color="#990000"> </font><font color="#990000">   </font></p>

<p><font color="#990000"> </font>
<pre /><font color="#990000"> #define asmlinkage CPP_ASMLINKAGE  #endif</font>
<font color="#000000"> </font><font color="#000000">   进一步，CPP_ASMLINKAGE的定义为:</font></p>

<p><font color="#000000"> </font><font color="#000000">   </font></p>

<p><font color="#000000"> </font>
<pre /><font color="#990000"> #ifdef __cplusplus </font>
<font color="#990000"> </font><font color="#990000">   </font></p>

<p><font color="#990000"> </font>
<pre /><font color="#990000">#define CPP_ASMLINKAGE extern "C"</font></p>

<p>#else</p>

<p>#define CPP_ASMLINKAGE</p>

<p>#endif
<font color="#000000"> </font><font color="#000000">    而在include/asm-i386/linkage.h里则有更明确的定义：</font></p>

<p><font color="#000000"> </font><font color="#990000">    #define asmlinkage CPP_ASMLINKAGE __attribute__((regparm(0)))</font></p>

<p><font color="#000000"> </font><font color="#000000">    __attribute__是GCC的C语言扩展语法。regparm(0)表示不从寄存器中传递参数。</font></p>

<p><font color="#000000"> </font><font color="#000000"> 另外,如果是__attribute__((regparm(3)))，那么调用函数的时候参数不是通过栈传递，而是直接放到寄存器里，被调用函数直接从寄存器取参数。</font></p>

<p><font color="#000000"> </font><font color="#000000">此句引自了<a target="_parent" href="http://nearxlz.blogchina.com/4959914.html">海中一浪的博客文章</a> </font></p>

<p><font color="#000000"><strong>asmlinkage确保它定义的函数从栈中读取参数而不是在寄存器中。</strong></font></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2006/08/15/__init__exit/">啥是__init __exit宏</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-08-15T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2006/08/15/__init__exit/#disqus_thread"
             data-disqus-identifier="http://lerosua.github.io/blog/2006/08/15/__init__exit/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>(学习内核笔记由此开始)</p>

<p>更详细内容请<a target="_parent" href="http://www.kernelnewbies.org/FAQ/InitExitMacros">kernelnewibes</a>
原始定义在include/linux/init.h
<pre>#define __init          __attribute__ ((__section__ (".init.text")))</pre>
<pre>#define __initdata      __attribute__ ((__section__ (".init.data")))</pre></p>

<p>#define __exitdata      __attribute__ ((__section__(&#8220;.exit.data&#8221;)))</p>

<p>#define __exit_call     __attribute_used__ __attribute__ ((__section__ (&#8220;.exitcall.exit&#8221;)))</p>

<p>#ifdef MODULE</p>

<p>#define __exit          __attribute__ ((__section__(&#8220;.exit.text&#8221;)))</p>

<p>#else</p>

<p>#define __exit          __attribute_used__ __attribute__ ((__section__(&#8220;.exit.text&#8221;)))</p>

<p>#endif
__init和__exit标记函数，__initdata和__exitdata标记数据。</p>

<p>此宏定义可知标记后的函数与数据其实是放到了特定的（代码或数据）段中。</p>

<p>标记为初始化的函数表明公在初始化期间使用。<br />
在模块装载之后，模块装载就</p>

<p>会将初始化函数扔掉。这样可以将该函数占用的内存释放出来。</p>

<p>__exit修饰词标记函数只在模块卸载时使用。如果模块被直接编进内核</p>

<p>或内核不允许卸载模块。被此标记的函数将被简单地丢弃。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2006/08/12/pay/">第一次工资</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-08-12T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2006/08/12/pay/#disqus_thread"
             data-disqus-identifier="http://lerosua.github.io/blog/2006/08/12/pay/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>终于发工资了。对于这一工资，高中时期就已经承诺了去处了。</p>

<p>记得那时总和某某人说，发了第一次工资就请你吃大餐。发了第一次工资就买什么什么东西给你。发了第一次工资就给妈妈爸爸买啥买啥的。而今真的发第一次工资了。那些好朋友却没有能聚在一起了。这第一次工资也没能实现它当年的承诺。用来交房租，水电费。还有还之前的欠款，以及这个月的生活费。第一次工资已经所剩无几了。生活逼迫得我们有时都喘不过气来。</p>

<p>一会回家，把第一次工资的三分之一给家里，爸妈，儿子终于赚钱了。</p>

<p>这第一次工资还交了个人所得税。TMD还成了纳税人了。偶觉得起征点应该是三千。三年再修定一次,调高不高低。因为太多的钱给虫子吃掉了。国家应该开源节流，不乱花纳税人的钱，这样国库就不会空虚了啊。我记得好像某个人大委员曾经说把个人所得税调得太高会剥夺公民纳税的权利。我当时听了这句话我就在想这个哪个狗娘养说的话，根本就不是人话。如果偶有了杀人的冲动，第一个就把这个人拿来练靶子。</p>

<p>既然偶现在也是纳税人了，那偶也有权说两句了吧，国内某些官员是狗娘养的。如果有人听了觉得这太愤青，不要紧。偶可以改口啊！偶改为：国内某些官员不是狗娘养的。这样总行了吧！</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/65/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/63/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/12/31/2014nian-zhong-zong-jie/">2014年终总结</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/28/zhou-ji-zhu/">周记 &#8211; 竹</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/21/zhou-ji-zai/">周记 &#8211; 在</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/14/zhou-ji-feng/">周记 &#8211; 凤</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/07/zhou-ji-ming/">周记 &#8211; 鸣</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - lerosua -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'lerosua';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
